
/**********************************************************************
   串口收发程序（头文件）
   波特率：9600Hz
   可选定时器1或独立波特率作为串口时钟
**********************************************************************/


#ifndef __SET_SERIAL_H__
#define __SET_SERIAL_H__


sfr AUXR = 0x8E;
sfr BRT = 0x9C;


//***********************************************************************************/
 //定时器1初始化
/*void Init_Timer1()
{
    // set timer1 mode
   TMOD |= 0x20;   			 //设置timer1为8位自动重载模式
   SCON = 0x50;			     // 设定串行口工作方式
   PCON &= 0xef;			 // 波特率不倍增
   TH1=TL1=0xFD;			 //9600 Hz
   TR1 = 1;					 //开启Timer1

 }	*/



//***********************************************************************************/
 //独立波特率初始化

void Init_BRT()				////9600bps@20MHz
{
  
   PCON &= 0x7F;		//波特率不倍速
   SCON = 0x50;		    //8位数据,可变波特率
   AUXR |= 0x04;		//独立波特率发生器时钟为Fosc,即1T
   BRT = 0xBF;		    //设定独立波特率发生器重装值
   AUXR |= 0x01;		//串口1选择独立波特率发生器为波特率发生器
   AUXR |= 0x10;		//启动独立波特率发生器

 }



//***********************************************************************************/
 //串口接收程序

 receive_char() //receive data
{
  unsigned char rxd; 
  if(RI)					     
  {
	 RI = 0;
	 rxd = SBUF;
	 return(rxd);		 
  }
}



//***********************************************************************************/
 //串口发送子程序

 void send_char(unsigned char txd) //sent out data
{
	SBUF = txd;
	while(!TI);				
	TI = 0;					
}



#endif